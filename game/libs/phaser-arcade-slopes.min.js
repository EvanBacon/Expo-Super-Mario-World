import { Phaser } from 'expo-phaser';
var SAT = require('sat');
Phaser.Plugin.ArcadeSlopes=function(e,o,t){Phaser.Plugin.call(this,e,o);var r={};r[Phaser.Plugin.ArcadeSlopes.SAT]=new Phaser.Plugin.ArcadeSlopes.SatSolver,this.facade=new Phaser.Plugin.ArcadeSlopes.Facade(new Phaser.Plugin.ArcadeSlopes.TileSlopeFactory,r,t||Phaser.Plugin.ArcadeSlopes.SAT)},Phaser.Plugin.ArcadeSlopes.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.ArcadeSlopes.prototype.constructor=Phaser.Plugin.ArcadeSlopes,Phaser.Plugin.ArcadeSlopes.VERSION="0.2.0-dev",Phaser.Plugin.ArcadeSlopes.SAT="sat",Phaser.Plugin.ArcadeSlopes.prototype.init=function(){this.game.slopes=this.game.slopes||this.facade,this.originalCollideSpriteVsTilemapLayer=Phaser.Physics.Arcade.prototype.collideSpriteVsTilemapLayer,Phaser.Physics.Arcade.prototype.collideSpriteVsTile=Phaser.Plugin.ArcadeSlopes.Overrides.collideSpriteVsTile,Phaser.Physics.Arcade.prototype.collideSpriteVsTiles=Phaser.Plugin.ArcadeSlopes.Overrides.collideSpriteVsTiles,Phaser.Physics.Arcade.prototype.collideSpriteVsTilemapLayer=Phaser.Plugin.ArcadeSlopes.Overrides.collideSpriteVsTilemapLayer,Phaser.Tilemap.prototype.getTileTopLeft=Phaser.Plugin.ArcadeSlopes.Overrides.getTileTopLeft,Phaser.Tilemap.prototype.getTileTopRight=Phaser.Plugin.ArcadeSlopes.Overrides.getTileTopRight,Phaser.Tilemap.prototype.getTileBottomLeft=Phaser.Plugin.ArcadeSlopes.Overrides.getTileBottomLeft,Phaser.Tilemap.prototype.getTileBottomRight=Phaser.Plugin.ArcadeSlopes.Overrides.getTileBottomRight,Phaser.TilemapLayer.prototype.getCollisionOffsetX=Phaser.Plugin.ArcadeSlopes.Overrides.getCollisionOffsetX,Phaser.TilemapLayer.prototype.getCollisionOffsetY=Phaser.Plugin.ArcadeSlopes.Overrides.getCollisionOffsetY},Phaser.Plugin.ArcadeSlopes.prototype.destroy=function(){this.game.slopes=null,Phaser.Physics.Arcade.prototype.collideSpriteVsTile=null,Phaser.Physics.Arcade.prototype.collideSpriteVsTiles=null,Phaser.Physics.Arcade.prototype.collideSpriteVsTilemapLayer=this.originalCollideSpriteVsTilemapLayer,Phaser.Tilemap.prototype.getTileTopLeft=null,Phaser.Tilemap.prototype.getTileTopRight=null,Phaser.Tilemap.prototype.getTileBottomLeft=null,Phaser.Tilemap.prototype.getTileBottomRight=null,Phaser.TilemapLayer.prototype.getCollisionOffsetX=null,Phaser.TilemapLayer.prototype.getCollisionOffsetY=null,Phaser.Plugin.prototype.destroy.call(this)},Phaser.Plugin.ArcadeSlopes.Facade=function(e,o,t){this.factory=e,this.solvers=o,this.defaultSolver=t||Phaser.Plugin.ArcadeSlopes.SAT},Phaser.Plugin.ArcadeSlopes.Facade.prototype.enable=function(e){if(Array.isArray(e))for(var o=0;o<e.length;o++)this.enable(e[o]);else e instanceof Phaser.Group?this.enable(e.children):(e.hasOwnProperty("body")&&this.enableBody(e.body),e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children))},Phaser.Plugin.ArcadeSlopes.Facade.prototype.enableBody=function(e){e.isCircle?e.polygon=new SAT.Circle(new SAT.Vector(e.x+e.halfWidth,e.y+e.halfHeight),e.radius):e.polygon=new SAT.Box(new SAT.Vector(e.x,e.y),e.width,e.height).toPolygon(),e.slopes=Phaser.Utils.mixin(e.slopes||{},{debug:!1,friction:new Phaser.Point,preferY:!1,pullUp:0,pullDown:0,pullLeft:0,pullRight:0,pullTopLeft:0,pullTopRight:0,pullBottomLeft:0,pullBottomRight:0,sat:{response:null},skipFriction:!1,snapUp:0,snapDown:0,snapLeft:0,snapRight:0,velocity:new SAT.Vector})},Phaser.Plugin.ArcadeSlopes.Facade.prototype.convertTilemap=function(e,o,t,r){return this.factory.convertTilemap(e,o,t,r)},Phaser.Plugin.ArcadeSlopes.Facade.prototype.convertTilemapLayer=function(e,o,t){return this.factory.convertTilemapLayer(e,o,t)},Phaser.Plugin.ArcadeSlopes.Facade.prototype.collide=function(e,o,t,r,l){return t.slope.solver&&this.solvers.hasOwnProperty(t.slope.solver)?this.solvers[t.slope.solver].collide(e,o,t,r,l):this.solvers[this.defaultSolver].collide(e,o,t,r,l)},Phaser.Plugin.ArcadeSlopes.Overrides={},Phaser.Plugin.ArcadeSlopes.Overrides.collideSpriteVsTile=function(e,o,t,r,l,i,s,n){if(!o.body)return!1;if(t.hasOwnProperty("slope")){if(this.game.slopes.collide(e,o.body,t,r,n))return this._total++,l&&l.call(s,o,t),!0}else if(this.separateTile(e,o.body,t,r,n))return this._total++,l&&l.call(s,o,t),!0;return!1},Phaser.Plugin.ArcadeSlopes.Overrides.collideSpriteVsTiles=function(e,o,t,r,l,i,s){var n=!1;if(!e.body)return n;for(var p=0;p<o.length;p++)l?l.call(i,e,o[p])&&(n=this.collideSpriteVsTile(p,e,o[p],t,r,l,i,s)||n):n=this.collideSpriteVsTile(p,e,o[p],t,r,l,i,s)||n;return n},Phaser.Plugin.ArcadeSlopes.Overrides.collideSpriteVsTilemapLayer=function(e,o,t,r,l,i){if(!e.body)return!1;var s=o.getTiles(e.body.position.x-e.body.tilePadding.x-o.getCollisionOffsetX(),e.body.position.y-e.body.tilePadding.y-o.getCollisionOffsetY(),e.body.width+e.body.tilePadding.x,e.body.height+e.body.tilePadding.y,!1,!1);if(0===s.length)return!1;var n=this.collideSpriteVsTiles(e,s,o,t,r,l,i);return n||i||this.game.slopes.solvers.sat.snap(e.body,s),n},Phaser.Plugin.ArcadeSlopes.Overrides.getTileTopLeft=function(e,o,t){return o>0&&t>0?this.layers[e].data[t-1][o-1]:null},Phaser.Plugin.ArcadeSlopes.Overrides.getTileTopRight=function(e,o,t){return o<this.layers[e].width-1&&t>0?this.layers[e].data[t-1][o+1]:null},Phaser.Plugin.ArcadeSlopes.Overrides.getTileBottomLeft=function(e,o,t){return o>0&&t<this.layers[e].height-1?this.layers[e].data[t+1][o-1]:null},Phaser.Plugin.ArcadeSlopes.Overrides.getTileBottomRight=function(e,o,t){return o<this.layers[e].width-1&&t<this.layers[e].height-1?this.layers[e].data[t+1][o+1]:null},Phaser.Plugin.ArcadeSlopes.Overrides.getCollisionOffsetX=function(){return this.fixedToCamera?0:this.position.x},Phaser.Plugin.ArcadeSlopes.Overrides.getCollisionOffsetY=function(){return this.fixedToCamera?0:this.position.y},Phaser.Plugin.ArcadeSlopes.SatRestrainer=function(){this.restraints={},this.setDefaultRestraints()},Phaser.Plugin.ArcadeSlopes.SatRestrainer.prototype.restrain=function(e,o,t,r){if(!r.overlap||!t.neighbours||!this.restraints.hasOwnProperty(t.slope.type))return!0;for(var l in this.restraints[t.slope.type]){var i=this.restraints[t.slope.type][l],s=t.neighbours[i.neighbour];if(s&&s.slope){var n=!1;if(n=i.types?i.types.indexOf(s.slope.type)>-1:s.slope.type===t.slope.type,i.hasOwnProperty("overlapX")&&(n="number"==typeof i.overlapX?n&&r.overlapN.x===i.overlapX:n&&r.overlapN.x>=i.overlapX[0]&&r.overlapN.x<=i.overlapX[1]),i.hasOwnProperty("overlapY")&&(n="number"==typeof i.overlapY?n&&r.overlapN.y===i.overlapY:n&&r.overlapN.y>=i.overlapY[0]&&r.overlapN.y<=i.overlapY[1]),n){var p=i.separate;return"function"==typeof p&&(p=p.call(this,o,t,r)),p&&t.slope.axis&&e.collideOnAxis(o,t,t.slope.axis),!1}}}return!0},Phaser.Plugin.ArcadeSlopes.SatRestrainer.resolveOverlaps=function(e){switch(e){case"up":return{overlapX:0,overlapY:[-1,0]};case"down":return{overlapX:0,overlapY:[0,1]};case"left":return{overlapX:[-1,0],overlapY:0};case"right":return{overlapX:[0,1],overlapY:0}}return console.warn("Unknown overlap direction '"+e+"'"),{}},Phaser.Plugin.ArcadeSlopes.SatRestrainer.prepareRestraints=function(e){var o={};for(var t in e){var r=e[t];for(var l in r){var i=r[l];if(i.direction){var s=Phaser.Plugin.ArcadeSlopes.SatRestrainer.resolveOverlaps(i.direction);i.overlapX=s.overlapX,i.overlapY=s.overlapY}for(var n in i.types)i.types[n]=Phaser.Plugin.ArcadeSlopes.TileSlope.resolveType(i.types[n]);i.separate!==!1&&"function"!=typeof i.separate&&(i.separate=!0)}var p=Phaser.Plugin.ArcadeSlopes.TileSlope.resolveType(t);o[p]=r}return o},Phaser.Plugin.ArcadeSlopes.SatRestrainer.prototype.setDefaultRestraints=function(){var e={};e.HALF_TOP=[{direction:"left",neighbour:"left",types:this.resolve("topRight","right"),separate:!1},{direction:"right",neighbour:"right",types:this.resolve("topLeft","left"),separate:!1}],e.HALF_BOTTOM=[{direction:"left",neighbour:"left",types:this.resolve("right","bottomRight"),separate:!1},{direction:"right",neighbour:"right",types:this.resolve("left","bottomLeft"),separate:!1}],e.HALF_LEFT=[{direction:"up",neighbour:"above",types:this.resolve("bottomLeft","bottom"),separate:!1},{direction:"down",neighbour:"below",types:this.resolve("topLeft","top"),separate:!1}],e.HALF_RIGHT=[{direction:"up",neighbour:"above",types:this.resolve("bottom","bottomRight"),separate:!1},{direction:"down",neighbour:"below",types:this.resolve("top","topRight"),separate:!1}],e.HALF_BOTTOM_LEFT=[{direction:"right",neighbour:"bottomRight",types:this.resolve("topLeft")},{direction:"up",neighbour:"topLeft",types:this.resolve("bottomRight")}],e.HALF_BOTTOM_RIGHT=[{direction:"left",neighbour:"bottomLeft",types:this.resolve("topRight")},{direction:"up",neighbour:"topRight",types:this.resolve("bottomLeft")}],e.HALF_TOP_LEFT=[{direction:"right",neighbour:"topRight",types:this.resolve("bottomLeft")},{direction:"down",neighbour:"bottomLeft",types:this.resolve("topRight")}],e.HALF_TOP_RIGHT=[{direction:"left",neighbour:"topLeft",types:this.resolve("bottomRight")},{direction:"down",neighbour:"bottomRight",types:this.resolve("topLeft")}],e.QUARTER_BOTTOM_LEFT_LOW=[{direction:"right",neighbour:"bottomRight",types:this.resolve("topLeft")},{direction:"up",neighbour:"left",types:this.resolve("topLeft","right","bottomRight")},{direction:"left",neighbour:"left",types:this.resolve("right","bottomRight"),separate:!1}],e.QUARTER_BOTTOM_LEFT_HIGH=[{direction:"right",neighbour:"right",types:this.resolve("left","bottomLeft"),separate:function(e,o){return e.bottom<o.bottom}},{direction:"up",neighbour:"topLeft",types:this.resolve("bottomRight")}],e.QUARTER_BOTTOM_RIGHT_LOW=[{direction:"left",neighbour:"bottomLeft",types:this.resolve("topRight")},{direction:"up",neighbour:"right",types:this.resolve("topRight","left","bottomLeft")},{direction:"right",neighbour:"right",types:this.resolve("left","bottomLeft"),separate:!1}],e.QUARTER_BOTTOM_RIGHT_HIGH=[{direction:"left",neighbour:"left",types:this.resolve("right","bottomRight"),separate:function(e,o){return e.bottom<o.bottom}},{direction:"up",neighbour:"topRight",types:this.resolve("bottomLeft")}],e.QUARTER_LEFT_BOTTOM_LOW=[{direction:"up",neighbour:"above",types:this.resolve("topLeft","left"),separate:function(e,o){return e.left>o.left}},{direction:"right",neighbour:"bottomRight",types:this.resolve("topLeft")}],e.QUARTER_LEFT_BOTTOM_HIGH=[{direction:"up",neighbour:"topLeft",types:this.resolve("bottomRight")},{direction:"down",neighbour:"below",types:this.resolve("topLeft","top"),separate:!1},{direction:"right",neighbour:"below",types:this.resolve("topLeft","top","bottomRight")}],e.QUARTER_RIGHT_BOTTOM_LOW=[{direction:"up",neighbour:"above",types:this.resolve("bottom","bottomRight"),separate:function(e,o){return e.right<o.right}},{direction:"left",neighbour:"bottomLeft",types:this.resolve("topRight")}],e.QUARTER_RIGHT_BOTTOM_HIGH=[{direction:"up",neighbour:"topRight",types:this.resolve("bottomLeft")},{direction:"down",neighbour:"below",types:this.resolve("top","topRight"),separate:!1},{direction:"left",neighbour:"below",types:this.resolve("top","topRight","bottomLeft")}],e.QUARTER_LEFT_TOP_LOW=[{direction:"up",neighbour:"above",types:this.resolve("bottomLeft","bottom")},{direction:"right",neighbour:"above",types:this.resolve("bottomLeft","bottom"),separate:!1},{direction:"down",neighbour:"bottomLeft",types:this.resolve("topRight")}],e.QUARTER_LEFT_TOP_HIGH=[{direction:"right",neighbour:"topRight",types:this.resolve("bottomLeft")},{direction:"down",neighbour:"below",types:this.resolve("topLeft","top"),separate:function(e,o){return e.left>o.left}}],e.QUARTER_RIGHT_TOP_LOW=[{direction:"up",neighbour:"above",types:this.resolve("bottom","bottomRight")},{direction:"left",neighbour:"above",types:this.resolve("bottom","bottomRight"),separate:!1},{direction:"down",neighbour:"bottomRight",types:this.resolve("topLeft")}],e.QUARTER_RIGHT_TOP_HIGH=[{direction:"left",neighbour:"topLeft",types:this.resolve("bottomRight")},{direction:"down",neighbour:"below",types:this.resolve("top","topRight"),separate:function(e,o){return e.right<o.right}}],e.QUARTER_TOP_LEFT_LOW=[{direction:"right",neighbour:"topRight",types:this.resolve("bottomLeft")},{direction:"left",neighbour:"left",types:this.resolve("topRight","right"),separate:!1},{direction:"down",neighbour:"left",types:this.resolve("bottomLeft","topRight","right")}],e.QUARTER_TOP_LEFT_HIGH=[{direction:"right",neighbour:"right",types:this.resolve("topLeft","left"),separate:function(e,o){return e.top>o.top}},{direction:"down",neighbour:"bottomLeft",types:this.resolve("topRight")}],e.QUARTER_TOP_RIGHT_LOW=[{direction:"left",neighbour:"topLeft",types:this.resolve("bottomRight")},{direction:"right",neighbour:"right",types:this.resolve("topLeft","left"),separate:!1},{direction:"down",neighbour:"right",types:this.resolve("bottomRight","topLeft","left")}],e.QUARTER_TOP_RIGHT_HIGH=[{direction:"left",neighbour:"left",types:this.resolve("topRight","right"),separate:function(e,o){return e.top>o.top}},{direction:"down",neighbour:"bottomRight",types:this.resolve("topLeft")}],this.informalRestraints=JSON.parse(JSON.stringify(e)),this.restraints=Phaser.Plugin.ArcadeSlopes.SatRestrainer.prepareRestraints(e)},Phaser.Plugin.ArcadeSlopes.SatRestrainer.intersectArrays=function(e,o){return e.filter(function(e){return o.indexOf(e)!==-1}).filter(function(e,o,t){return t.indexOf(e)===o})},Phaser.Plugin.ArcadeSlopes.SatRestrainer.prototype.resolve=function(){var e=[];if(!arguments.length)return e;for(var o in arguments){var t=arguments[o];if(Phaser.Plugin.ArcadeSlopes.SatRestrainer.hasOwnProperty(t+"Vertices")){var r=Array.prototype.slice.call(Phaser.Plugin.ArcadeSlopes.SatRestrainer[t+"Vertices"]);if(1===arguments.length)return r;e=e.length?Phaser.Plugin.ArcadeSlopes.SatRestrainer.intersectArrays(e,r):r}else console.warn("Tried to resolve types from undefined vertex map location '"+t+"'")}return e},Phaser.Plugin.ArcadeSlopes.SatRestrainer.topVertices=["HALF_LEFT","HALF_RIGHT","QUARTER_LEFT_TOP_LOW","QUARTER_RIGHT_TOP_LOW","QUARTER_LEFT_BOTTOM_LOW","QUARTER_RIGHT_BOTTOM_LOW"],Phaser.Plugin.ArcadeSlopes.SatRestrainer.bottomVertices=["HALF_LEFT","HALF_RIGHT","QUARTER_LEFT_TOP_HIGH","QUARTER_LEFT_BOTTOM_HIGH","QUARTER_RIGHT_TOP_HIGH","QUARTER_RIGHT_BOTTOM_HIGH"],Phaser.Plugin.ArcadeSlopes.SatRestrainer.leftVertices=["HALF_TOP","HALF_BOTTOM","QUARTER_TOP_LEFT_LOW","QUARTER_TOP_RIGHT_HIGH","QUARTER_BOTTOM_LEFT_LOW","QUARTER_BOTTOM_RIGHT_HIGH"],Phaser.Plugin.ArcadeSlopes.SatRestrainer.rightVertices=["HALF_TOP","HALF_BOTTOM","QUARTER_TOP_LEFT_HIGH","QUARTER_TOP_RIGHT_LOW","QUARTER_BOTTOM_LEFT_HIGH","QUARTER_BOTTOM_RIGHT_LOW"],Phaser.Plugin.ArcadeSlopes.SatRestrainer.topLeftVertices=["FULL","HALF_TOP","HALF_LEFT","HALF_TOP_LEFT","HALF_TOP_RIGHT","HALF_BOTTOM_LEFT","QUARTER_TOP_LEFT_LOW","QUARTER_TOP_LEFT_HIGH","QUARTER_TOP_RIGHT_HIGH","QUARTER_BOTTOM_LEFT_HIGH","QUARTER_LEFT_TOP_LOW","QUARTER_LEFT_TOP_HIGH","QUARTER_LEFT_BOTTOM_LOW","QUARTER_LEFT_BOTTOM_HIGH","QUARTER_RIGHT_TOP_HIGH"],Phaser.Plugin.ArcadeSlopes.SatRestrainer.topRightVertices=["FULL","HALF_TOP","HALF_RIGHT","HALF_TOP_LEFT","HALF_TOP_RIGHT","HALF_BOTTOM_RIGHT","QUARTER_TOP_LEFT_LOW","QUARTER_TOP_LEFT_HIGH","QUARTER_TOP_RIGHT_LOW","QUARTER_TOP_RIGHT_HIGH","QUARTER_BOTTOM_RIGHT_HIGH","QUARTER_LEFT_TOP_HIGH","QUARTER_RIGHT_TOP_LOW","QUARTER_RIGHT_TOP_HIGH","QUARTER_RIGHT_BOTTOM_LOW","QUARTER_RIGHT_BOTTOM_HIGH"],Phaser.Plugin.ArcadeSlopes.SatRestrainer.bottomLeftVertices=["FULL","HALF_LEFT","HALF_BOTTOM","HALF_TOP_LEFT","HALF_BOTTOM_LEFT","HALF_BOTTOM_RIGHT","QUARTER_TOP_LEFT_HIGH","QUARTER_BOTTOM_LEFT_LOW","QUARTER_BOTTOM_LEFT_HIGH","QUARTER_BOTTOM_RIGHT_LOW","QUARTER_BOTTOM_RIGHT_HIGH","QUARTER_LEFT_TOP_HIGH","QUARTER_LEFT_BOTTOM_LOW","QUARTER_LEFT_BOTTOM_HIGH","QUARTER_RIGHT_BOTTOM_LOW"],Phaser.Plugin.ArcadeSlopes.SatRestrainer.bottomRightVertices=["FULL","HALF_RIGHT","HALF_BOTTOM","HALF_TOP_RIGHT","HALF_BOTTOM_LEFT","HALF_BOTTOM_RIGHT","QUARTER_TOP_RIGHT_HIGH","QUARTER_BOTTOM_LEFT_LOW","QUARTER_BOTTOM_LEFT_HIGH","QUARTER_BOTTOM_RIGHT_LOW","QUARTER_BOTTOM_RIGHT_HIGH","QUARTER_LEFT_BOTTOM_LOW","QUARTER_RIGHT_TOP_HIGH","QUARTER_RIGHT_BOTTOM_LOW","QUARTER_RIGHT_BOTTOM_HIGH"],Phaser.Plugin.ArcadeSlopes.SatSolver=function(e){this.options=Phaser.Utils.mixin(e||{},{debug:!1,preferY:!1,restrain:!0}),this.restrainers=[new Phaser.Plugin.ArcadeSlopes.SatRestrainer]},Phaser.Plugin.ArcadeSlopes.SatSolver.prepareResponse=function(e){return e.overlapV.scale(-1),e.overlapN.scale(-1),e},Phaser.Plugin.ArcadeSlopes.SatSolver.minimumOffsetX=function(e){return e.y*e.y/e.x+e.x},Phaser.Plugin.ArcadeSlopes.SatSolver.minimumOffsetY=function(e){return e.x*e.x/e.y+e.y},Phaser.Plugin.ArcadeSlopes.SatSolver.movingAgainstY=function(e,o){return o.overlapV.y<0&&e.velocity.y>0||o.overlapV.y>0&&e.velocity.y<0},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.shouldPreferY=function(e,o){return(this.options.preferY||e.slopes.preferY)&&0!==o.overlapV.y&&0!==o.overlapV.x&&Phaser.Plugin.ArcadeSlopes.SatSolver.movingAgainstY(e,o)},Phaser.Plugin.ArcadeSlopes.SatSolver.isSeparatingAxis=function(e,o,t,r){var l=SAT.isSeparatingAxis(e.pos,o.pos,e.points,o.points,t,r||null);return r&&(r.a=e,r.b=o,r.overlapV=r.overlapN.clone().scale(r.overlap)),l},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.separate=function(e,o,t,r){return!(!r&&!this.shouldSeparate(o.index,e,o,t))&&(!(o.collisionCallback&&!o.collisionCallback.call(o.collisionCallbackContext,e.sprite,o))&&(!(o.layer.callbacks[o.index]&&!o.layer.callbacks[o.index].callback.call(o.layer.callbacks[o.index].callbackContext,e.sprite,o))&&(this.shouldPreferY(e,t)?e.position.y+=Phaser.Plugin.ArcadeSlopes.SatSolver.minimumOffsetY(t.overlapV):(e.position.x+=t.overlapV.x,e.position.y+=t.overlapV.y),!0)))},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.applyVelocity=function(e,o,t){var r=e.slopes.velocity.clone().projectN(t.overlapN),l=e.slopes.velocity.clone().sub(r);r.x=r.x*-e.bounce.x,r.y=r.y*-e.bounce.y,l.x=l.x*(1-e.slopes.friction.x-o.slope.friction.x),l.y=l.y*(1-e.slopes.friction.y-o.slope.friction.y),e.velocity.x=r.x+l.x,e.velocity.y=r.y+l.y,this.pull(e,t)},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.updateValues=function(e){e.polygon.pos.x=e.x,e.polygon.pos.y=e.y,e.slopes.velocity.x=e.velocity.x,e.slopes.velocity.y=e.velocity.y},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.updateFlags=function(e,o){e.wasTouching.up=e.touching.up,e.wasTouching.down=e.touching.down,e.wasTouching.left=e.touching.left,e.wasTouching.right=e.touching.right,e.wasTouching.none=e.touching.none,e.touching.up=e.touching.up||o.overlapV.y>0,e.touching.down=e.touching.down||o.overlapV.y<0,e.touching.left=e.touching.left||o.overlapV.x>0,e.touching.right=e.touching.right||o.overlapV.x<0,e.touching.none=!(e.touching.up||e.touching.down||e.touching.left||e.touching.right),e.blocked.up=e.blocked.up||0===o.overlapV.x&&o.overlapV.y>0,e.blocked.down=e.blocked.down||0===o.overlapV.x&&o.overlapV.y<0,e.blocked.left=e.blocked.left||0===o.overlapV.y&&o.overlapV.x>0,e.blocked.right=e.blocked.right||0===o.overlapV.y&&o.overlapV.x<0},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.snap=function(e,o){if(!(e.slopes||e.slopes.snapUp||e.slopes.snapDown||e.slopes.snapLeft||e.slopes.snapRight))return!1;var t=new Phaser.Point(e.position.x,e.position.y);for(var r in o){var l=o[r];if(l.slope){if(e.slopes.snapUp&&(e.position.x=t.x,e.position.y=t.y-e.slopes.snapUp,this.snapCollide(e,l,t)))return!0;if(e.slopes.snapDown&&(e.position.x=t.x,e.position.y=t.y+e.slopes.snapDown,this.snapCollide(e,l,t)))return!0;if(e.slopes.snapLeft&&(e.position.x=t.x-e.slopes.snapLeft,e.position.y=t.y,this.snapCollide(e,l,t)))return!0;if(e.slopes.snapRight&&(e.position.x=t.x+e.slopes.snapRight,e.position.y=t.y,this.snapCollide(e,l,t)))return!0}}return!1},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.pull=function(e,o){if(!(e.slopes.pullUp||e.slopes.pullDown||e.slopes.pullLeft||e.slopes.pullRight||e.slopes.pullTopLeft||e.slopes.pullTopRight||e.slopes.pullBottomLeft||e.slopes.pullBottomRight))return!1;var t=o.overlapN.clone().scale(-1);return e.slopes.pullUp&&t.y<0?(pullUp=t.clone().scale(e.slopes.pullUp),e.velocity.x+=pullUp.x,e.velocity.y+=pullUp.y,!0):e.slopes.pullDown&&t.y>0?(pullDown=t.clone().scale(e.slopes.pullDown),e.velocity.x+=pullDown.x,e.velocity.y+=pullDown.y,!0):e.slopes.pullLeft&&t.x<0?(pullLeft=t.clone().scale(e.slopes.pullLeft),e.velocity.x+=pullLeft.x,e.velocity.y+=pullLeft.y,!0):e.slopes.pullRight&&t.x>0?(pullRight=t.clone().scale(e.slopes.pullRight),e.velocity.x+=pullRight.x,e.velocity.y+=pullRight.y,!0):e.slopes.pullTopLeft&&t.x<0&&t.y<0?(pullUp=t.clone().scale(e.slopes.pullTopLeft),e.velocity.x+=pullUp.x,e.velocity.y+=pullUp.y,!0):e.slopes.pullTopRight&&t.x>0&&t.y<0?(pullDown=t.clone().scale(e.slopes.pullTopRight),e.velocity.x+=pullDown.x,e.velocity.y+=pullDown.y,!0):e.slopes.pullBottomLeft&&t.x<0&&t.y>0?(pullLeft=t.clone().scale(e.slopes.pullBottomLeft),e.velocity.x+=pullLeft.x,e.velocity.y+=pullLeft.y,!0):!!(e.slopes.pullBottomRight&&t.x>0&&t.y>0)&&(pullRight=t.clone().scale(e.slopes.pullBottomRight),e.velocity.x+=pullRight.x,e.velocity.y+=pullRight.y,!0)},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.snapCollide=function(e,o,t){return!!this.collide(0,e,o)||(e.position.x=t.x,e.position.y=t.y,!1)},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.shouldCollide=function(e,o){return e.enable&&e.polygon&&e.slopes&&o.collides&&o.slope&&o.slope.polygon},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.collide=function(e,o,t,r,l){if(this.updateValues(o),!this.shouldCollide(o,t))return!1;o.isCircle&&(o.polygon.pos.x+=o.halfWidth,o.polygon.pos.y+=o.halfHeight),t.slope.polygon.pos.x=t.worldX+r.getCollisionOffsetX(),t.slope.polygon.pos.y=t.worldY+r.getCollisionOffsetY();var i=new SAT.Response;return!(o.isCircle&&!SAT.testCirclePolygon(o.polygon,t.slope.polygon,i)||!o.isCircle&&!SAT.testPolygonPolygon(o.polygon,t.slope.polygon,i))&&(!!l||(o.overlapX=i.overlapV.x,o.overlapY=i.overlapV.y,o.slopes.sat.response=i,Phaser.Plugin.ArcadeSlopes.SatSolver.prepareResponse(i),!!this.separate(o,t,i)&&(this.applyVelocity(o,t,i),this.updateFlags(o,i),!0)))},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.collideOnAxis=function(e,o,t,r){if(this.updateValues(e),!this.shouldCollide(e,o))return!1;r=r||new SAT.Response;var l=Phaser.Plugin.ArcadeSlopes.SatSolver.isSeparatingAxis(e.polygon,o.slope.polygon,t,r);return!l&&(Phaser.Plugin.ArcadeSlopes.SatSolver.prepareResponse(r),!!this.separate(e,o,r,!0)&&(this.applyVelocity(e,o,r),this.updateFlags(e,r),!0))},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.restrain=function(e,o,t){for(var r in this.restrainers){var l=this.restrainers[r];if("function"==typeof l.restrain&&!l.restrain(this,e,o,t))return!0}return!1},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.shouldSeparate=function(e,o,t,r){return!(!o.enable||!r.overlap)&&(!((!t.collideUp||t.slope.edges.top===Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY)&&r.overlapN.y<0&&0===r.overlapN.x)&&(!((!t.collideDown||t.slope.edges.bottom===Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY)&&r.overlapN.y>0&&0===r.overlapN.x)&&(!((!t.collideLeft||t.slope.edges.left===Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY)&&r.overlapN.x<0&&0===r.overlapN.y)&&(!((!t.collideRight||t.slope.edges.right===Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY)&&r.overlapN.x>0&&0===r.overlapN.y)&&(!(r.overlapV.clone().scale(-1).dot(o.slopes.velocity)<0)&&(!(this.options.restrain&&!o.isCircle)||!this.restrain(o,t,r)))))))},Phaser.Plugin.ArcadeSlopes.SatSolver.prototype.debug=function(e,o){},Phaser.Plugin.ArcadeSlopes.TileSlope=function(e,o,t,r,l,i){this.type=e,this.tile=o,this.polygon=t,this.line=r,this.edges=Phaser.Utils.mixin(l||{},{top:Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID,bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID,left:Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID,right:Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID}),this.axis=i||null,this.solver=null,this.friction=new Phaser.Point},Phaser.Plugin.ArcadeSlopes.TileSlope.resolveType=function(e){return parseInt(e)>=0?e:("string"==typeof e&&(e=e.toUpperCase()),Phaser.Plugin.ArcadeSlopes.TileSlope.hasOwnProperty(e)?Phaser.Plugin.ArcadeSlopes.TileSlope[e]:(console.warn("Unknown slope type '"+e+"'"),Phaser.Plugin.ArcadeSlopes.TileSlope.UNKNOWN))},Object.defineProperty(Phaser.Plugin.ArcadeSlopes.TileSlope.prototype,"slope",{get:function(){return this.line?(this.line.start.y-this.line.end.y)/(this.line.start.x-this.line.end.x):0}}),Object.defineProperty(Phaser.Plugin.ArcadeSlopes.TileSlope.prototype,"typeName",{get:function(){return Phaser.Plugin.ArcadeSlopes.TileSlope.resolveTypeName(this.type)},set:function(e){this.type=Phaser.Plugin.ArcadeSlopes.TileSlope.resolveType(e)}}),Phaser.Plugin.ArcadeSlopes.TileSlope.resolveTypeName=function(e){return Phaser.Plugin.ArcadeSlopes.TileSlope.typeNames.hasOwnProperty(e)?Phaser.Plugin.ArcadeSlopes.TileSlope.typeNames[e]:Phaser.Plugin.ArcadeSlopes.TileSlope.typeNames[-1]},Phaser.Plugin.ArcadeSlopes.TileSlope.typeNames={"-1":"UNKNOWN",0:"FULL",21:"HALF_BOTTOM",22:"HALF_TOP",23:"HALF_LEFT",24:"HALF_RIGHT",1:"HALF_BOTTOM_LEFT",2:"HALF_BOTTOM_RIGHT",3:"HALF_TOP_LEFT",4:"HALF_TOP_RIGHT",5:"QUARTER_BOTTOM_LEFT_LOW",6:"QUARTER_BOTTOM_LEFT_HIGH",7:"QUARTER_BOTTOM_RIGHT_LOW",8:"QUARTER_BOTTOM_RIGHT_HIGH",9:"QUARTER_LEFT_BOTTOM_LOW",10:"QUARTER_LEFT_BOTTOM_HIGH",11:"QUARTER_RIGHT_BOTTOM_LOW",12:"QUARTER_RIGHT_BOTTOM_HIGH",13:"QUARTER_LEFT_TOP_LOW",14:"QUARTER_LEFT_TOP_HIGH",15:"QUARTER_RIGHT_TOP_LOW",16:"QUARTER_RIGHT_TOP_HIGH",17:"QUARTER_TOP_LEFT_LOW",18:"QUARTER_TOP_LEFT_HIGH",19:"QUARTER_TOP_RIGHT_LOW",20:"QUARTER_TOP_RIGHT_HIGH"},Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY=0,Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID=1,Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING=2,Phaser.Plugin.ArcadeSlopes.TileSlope.UNKNOWN=-1,Phaser.Plugin.ArcadeSlopes.TileSlope.FULL=0,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_BOTTOM=21,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_TOP=22,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_LEFT=23,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_RIGHT=24,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_BOTTOM_LEFT=1,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_BOTTOM_RIGHT=2,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_TOP_LEFT=3,Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_TOP_RIGHT=4,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_LEFT_LOW=5,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_LEFT_HIGH=6,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_RIGHT_LOW=7,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_RIGHT_HIGH=8,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_BOTTOM_LOW=9,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_BOTTOM_HIGH=10,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_BOTTOM_LOW=11,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_BOTTOM_HIGH=12,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_TOP_LOW=13,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_TOP_HIGH=14,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_TOP_LOW=15,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_TOP_HIGH=16,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_LEFT_LOW=17,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_LEFT_HIGH=18,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_RIGHT_LOW=19,Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_RIGHT_HIGH=20,Phaser.Plugin.ArcadeSlopes.TileSlopeFactory=function(){this.definitions={},this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.FULL]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createFull,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_BOTTOM]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfBottom,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_TOP]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfTop,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_LEFT]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfLeft,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_RIGHT]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfRight,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_BOTTOM_LEFT]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfBottomLeft,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_BOTTOM_RIGHT]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfBottomRight,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_TOP_LEFT]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfTopLeft,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.HALF_TOP_RIGHT]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfTopRight,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_LEFT_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomLeftLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_LEFT_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomLeftHigh,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_RIGHT_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomRightLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_BOTTOM_RIGHT_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomRightHigh,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_BOTTOM_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftBottomLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_BOTTOM_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftBottomHigh,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_BOTTOM_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightBottomLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_BOTTOM_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightBottomHigh,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_TOP_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftTopLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_LEFT_TOP_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftTopHigh,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_TOP_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightTopLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_RIGHT_TOP_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightTopHigh,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_LEFT_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopLeftLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_LEFT_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopLeftHigh,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_RIGHT_LOW]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopRightLow,this.definitions[Phaser.Plugin.ArcadeSlopes.TileSlope.QUARTER_TOP_RIGHT_HIGH]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopRightHigh,this.mappings={},this.mappings[Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.NINJA]=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.mapNinjaPhysics},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.constructor=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory,Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.define=function(e,o){"function"==typeof o&&(this.definitions[e]=o)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.create=function(e,o){var t=e;return e=Phaser.Plugin.ArcadeSlopes.TileSlope.resolveType(t),this.definitions.hasOwnProperty(e)?"function"!=typeof this.definitions[e]?(console.warn("Slope type definition for type "+t+" is not a function"),null):this.definitions[e].call(this,e,o):(console.warn("Slope type "+t+" not defined"),null)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.convertTilemap=function(e,o,t,r){return o=e.getLayer(o),this.convertTilemapLayer(o,t,r),e},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.convertTilemapLayer=function(e,o,t){var r=this;if("string"==typeof o){var l=this.resolveMappingType(o);if(!this.mappings[l])return console.warn("Tilemap could not be converted; mapping type '"+o+"' is unknown"),e;o=this.mappings[l](t)}return e.layer.data.forEach(function(t){t.forEach(function(t){if(o.hasOwnProperty(t.index)){var l=r.create(o[t.index],t);l&&(t.slope=l)}var i=t.x,s=t.y;t.neighbours=t.neighbours||{},
t.neighbours.above=e.map.getTileAbove(e.index,i,s),t.neighbours.below=e.map.getTileBelow(e.index,i,s),t.neighbours.left=e.map.getTileLeft(e.index,i,s),t.neighbours.right=e.map.getTileRight(e.index,i,s),t.neighbours.topLeft=e.map.getTileTopLeft(e.index,i,s),t.neighbours.topRight=e.map.getTileTopRight(e.index,i,s),t.neighbours.bottomLeft=e.map.getTileBottomLeft(e.index,i,s),t.neighbours.bottomRight=e.map.getTileBottomRight(e.index,i,s)})}),this.calculateEdges(e),e},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.calculateEdges=function(e){for(var o=null,t=null,r=null,l=null,i=0,s=e.layer.height;i<s;i++)for(var n=0,p=e.layer.width;n<p;n++){var a=e.layer.data[i][n];a&&a.hasOwnProperty("slope")&&(o=e.map.getTileAbove(e.index,n,i),t=e.map.getTileBelow(e.index,n,i),r=e.map.getTileLeft(e.index,n,i),l=e.map.getTileRight(e.index,n,i),o&&o.hasOwnProperty("slope")&&(a.slope.edges.top=this.compareEdges(a.slope.edges.top,o.slope.edges.bottom),a.collideUp=a.slope.edges.top!==Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY,this.flagInternalVertices(a,o)),t&&t.hasOwnProperty("slope")&&(a.slope.edges.bottom=this.compareEdges(a.slope.edges.bottom,t.slope.edges.top),a.collideDown=a.slope.edges.bottom!==Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY,this.flagInternalVertices(a,t)),r&&r.hasOwnProperty("slope")&&(a.slope.edges.left=this.compareEdges(a.slope.edges.left,r.slope.edges.right),a.collideLeft=a.slope.edges.left!==Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY,this.flagInternalVertices(a,r)),l&&l.hasOwnProperty("slope")&&(a.slope.edges.right=this.compareEdges(a.slope.edges.right,l.slope.edges.left),a.collideRight=a.slope.edges.right!==Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY,this.flagInternalVertices(a,l)))}},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.compareEdges=function(e,o){return e===Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID&&o===Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID?Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY:e===Phaser.Plugin.ArcadeSlopes.TileSlope.SOLID&&o===Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY?Phaser.Plugin.ArcadeSlopes.TileSlope.EMPTY:e},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.flagInternalVertices=function(e,o){if(e.slope.polygon&&o.slope.polygon)for(var t=e.slope.polygon,r=o.slope.polygon,l=new SAT.Vector(e.worldX,e.worldY),i=new SAT.Vector(o.worldX,o.worldY),s=0;s<t.points.length;s++)for(var n=t.points[s].clone().add(l),p=t.points[(s+1)%t.points.length].clone().add(l),a=0;a<r.points.length;a++){var h=r.points[a].clone().add(i),T=r.points[(a+1)%r.points.length].clone().add(i),c=n.x===h.x&&n.y===h.y&&p.x===T.x&&p.y===T.y,u=n.x===T.x&&n.y===T.y&&p.x===h.x&&p.y===h.y;(c||u)&&(t.points[s].internal=!0,r.points[a].internal=!0)}},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prototype.resolveMappingType=function(e){return parseInt(e)>=0?e:("string"==typeof e&&(e=e.toUpperCase()),Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.hasOwnProperty(e)?Phaser.Plugin.ArcadeSlopes.TileSlopeFactory[e]:(console.warn("Unknown tileset mapping type '"+e+"'"),-1))},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createFull=function(e,o){var t=new SAT.Box(new SAT.Vector(o.worldX,o.worldY),o.width,o.height).toPolygon();return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfBottom=function(e,o){var t=o.height/2,r=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,t),new SAT.Vector(o.width,t),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),l=new Phaser.Line(o.left,o.top+o.height/2,o.right,o.top+o.height/2),i={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING};return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfTop=function(e,o){var t=o.height/2,r=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,t),new SAT.Vector(0,t)]),l=new Phaser.Line(o.left,o.top,o.right,o.top),i={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING};return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfLeft=function(e,o){var t=o.width/2,r=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(t,0),new SAT.Vector(t,o.height),new SAT.Vector(0,o.height)]),l=new Phaser.Line(o.left+t,o.top,o.left+t,o.bottom),i={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING};return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfRight=function(e,o){var t=o.width/2,r=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(t,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height),new SAT.Vector(t,o.height)]),l=new Phaser.Line(o.left+t,o.top,o.left+t,o.bottom),i={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING};return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfBottomLeft=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.top,o.right,o.bottom),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.7071067811865475,(-.7071067811865475));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfBottomRight=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.bottom,o.right,o.top),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.707106781186548),(-.707106781186548));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfTopLeft=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.right,o.top,o.left,o.bottom),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.7071067811865475,.7071067811865475);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createHalfTopRight=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height)]),r=new Phaser.Line(o.right,o.bottom,o.left,o.top),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.7071067811865475),.7071067811865475);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomLeftLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,o.height/2),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.top+o.height/2,o.right,o.bottom),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.4472135954999579,(-.8944271909999159));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomLeftHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,o.height/2),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.top,o.right,o.top+o.height/2),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.4472135954999579,(-.8944271909999159));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomRightLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(o.width,o.height/2),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.bottom,o.right,o.top+o.height/2),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.4472135954999579),(-.8944271909999159));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterBottomRightHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,o.height/2),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.bottom,o.right,o.top+o.height/2),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.4472135954999579),(-.8944271909999159));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftBottomLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width/2,0),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left+o.width/2,o.top,o.right,o.bottom),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.8944271909999159,(-.4472135954999579));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftBottomHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width/2,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.top,o.left+o.width/2,o.bottom),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.8944271909999159,(-.4472135954999579));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightBottomLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(o.width/2,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.bottom,o.left+o.width/2,o.top),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.8944271909999159),(-.4472135954999579));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightBottomHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height),new SAT.Vector(o.width/2,o.height)]),r=new Phaser.Line(o.left+o.width/2,o.bottom,o.right,o.top),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.8944271909999159),(-.4472135954999579));return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftTopLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width/2,0),new SAT.Vector(0,o.height)]),r=new Phaser.Line(0,o.height,o.width/2,0),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.8944271909999159,.4472135954999579);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterLeftTopHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width/2,o.height),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left+o.width/2,o.bottom,o.right,o.bottom),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.8944271909999159,.4472135954999579);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightTopLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(o.width/2,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height)]),r=new Phaser.Line(o.left+o.width/2,o.top,o.right,o.bottom),l={top:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.8944271909999159),.4472135954999579);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterRightTopHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height),new SAT.Vector(o.width/2,o.height)]),r=new Phaser.Line(o.left,o.top,o.left+o.width/2,o.bottom),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.8944271909999159),.4472135954999579);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopLeftLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(0,o.height/2)]),r=new Phaser.Line(o.left,o.top+o.height/2,o.right,o.top),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.4472135954999579,.8944271909999159);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopLeftHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height/2),new SAT.Vector(0,o.height)]),r=new Phaser.Line(o.left,o.bottom,o.right,o.top+o.height/2),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector(.4472135954999579,.8944271909999159);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopRightLow=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height/2)]),r=new Phaser.Line(o.left,o.top,o.right,o.top+o.height/2),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,right:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.4472135954999579),.8944271909999159);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.createQuarterTopRightHigh=function(e,o){var t=new SAT.Polygon(new SAT.Vector(o.worldX,o.worldY),[new SAT.Vector(0,0),new SAT.Vector(o.width,0),new SAT.Vector(o.width,o.height),new SAT.Vector(0,o.height/2)]),r=new Phaser.Line(o.left,o.top+o.height/2,o.right,o.top+o.height),l={bottom:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING,left:Phaser.Plugin.ArcadeSlopes.TileSlope.INTERESTING},i=new SAT.Vector((-.4472135954999579),.8944271909999159);return new Phaser.Plugin.ArcadeSlopes.TileSlope(e,o,t,r,l,i)},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prepareOffset=function(e){var o=parseInt(e);return o=isNaN(o)||"number"!=typeof o?0:o-1},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.mapNinjaPhysics=function(e){offset=Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.prepareOffset(e);var o={};return o[offset+2]="FULL",o[offset+3]="HALF_BOTTOM_LEFT",o[offset+4]="HALF_BOTTOM_RIGHT",o[offset+6]="HALF_TOP_LEFT",o[offset+5]="HALF_TOP_RIGHT",o[offset+15]="QUARTER_BOTTOM_LEFT_LOW",o[offset+16]="QUARTER_BOTTOM_RIGHT_LOW",o[offset+17]="QUARTER_TOP_RIGHT_LOW",o[offset+18]="QUARTER_TOP_LEFT_LOW",o[offset+19]="QUARTER_BOTTOM_LEFT_HIGH",o[offset+20]="QUARTER_BOTTOM_RIGHT_HIGH",o[offset+21]="QUARTER_TOP_RIGHT_HIGH",o[offset+22]="QUARTER_TOP_LEFT_HIGH",o[offset+23]="QUARTER_LEFT_BOTTOM_HIGH",o[offset+24]="QUARTER_RIGHT_BOTTOM_HIGH",o[offset+25]="QUARTER_RIGHT_TOP_LOW",o[offset+26]="QUARTER_LEFT_TOP_LOW",o[offset+27]="QUARTER_LEFT_BOTTOM_LOW",o[offset+28]="QUARTER_RIGHT_BOTTOM_LOW",o[offset+29]="QUARTER_RIGHT_TOP_HIGH",o[offset+30]="QUARTER_LEFT_TOP_HIGH",o[offset+31]="HALF_BOTTOM",o[offset+32]="HALF_RIGHT",o[offset+33]="HALF_TOP",o[offset+34]="HALF_LEFT",o},Phaser.Plugin.ArcadeSlopes.TileSlopeFactory.NINJA=1,function(e,o){"use strict";"function"==typeof define&&define.amd?define(o):"object"==typeof exports?module.exports=o():e.SAT=o()}(this,function(){"use strict";function e(e,o){this.x=e||0,this.y=o||0}function o(o,t){this.pos=o||new e,this.r=t||0}function t(o,t){this.pos=o||new e,this.angle=0,this.offset=new e,this.setPoints(t||[])}function r(o,t,r){this.pos=o||new e,this.w=t||0,this.h=r||0}function l(){this.a=null,this.b=null,this.overlapN=new e,this.overlapV=new e,this.clear()}function i(e,o,t){for(var r=Number.MAX_VALUE,l=-Number.MAX_VALUE,i=e.length,s=0;s<i;s++){var n=e[s].dot(o);n<r&&(r=n),n>l&&(l=n)}t[0]=r,t[1]=l}function s(e,o,t,r,l,s){var n=d.pop(),p=d.pop(),a=g.pop().copy(o).sub(e),h=a.dot(l);if(i(t,l,n),i(r,l,p),p[0]+=h,p[1]+=h,n[0]>p[1]||p[0]>n[1])return g.push(a),d.push(n),d.push(p),!0;if(s){var T=0;if(n[0]<p[0])if(s.aInB=!1,n[1]<p[1])T=n[1]-p[0],s.bInA=!1;else{var c=n[1]-p[0],u=p[1]-n[0];T=c<u?c:-u}else if(s.bInA=!1,n[1]>p[1])T=n[0]-p[1],s.aInB=!1;else{var c=n[1]-p[0],u=p[1]-n[0];T=c<u?c:-u}var S=Math.abs(T);S<s.overlap&&(s.overlap=S,s.overlapN.copy(l),T<0&&s.overlapN.reverse())}return g.push(a),d.push(n),d.push(p),!1}function n(e,o){var t=e.len2(),r=o.dot(e);return r<0?y:r>t?_:R}function p(e,o){var t=g.pop().copy(e).sub(o.pos),r=o.r*o.r,l=t.len2();return g.push(t),l<=r}function a(e,o){f.pos.copy(e),A.clear();var t=u(f,o,A);return t&&(t=A.aInB),t}function h(e,o,t){var r=g.pop().copy(o.pos).sub(e.pos),l=e.r+o.r,i=l*l,s=r.len2();if(s>i)return g.push(r),!1;if(t){var n=Math.sqrt(s);t.a=e,t.b=o,t.overlap=l-n,t.overlapN.copy(r.normalize()),t.overlapV.copy(r).scale(t.overlap),t.aInB=e.r<=o.r&&n<=o.r-e.r,t.bInA=o.r<=e.r&&n<=e.r-o.r}return g.push(r),!0}function T(e,o,t){for(var r=g.pop().copy(o.pos).sub(e.pos),l=o.r,i=l*l,s=e.calcPoints,p=s.length,a=g.pop(),h=g.pop(),T=0;T<p;T++){var c=T===p-1?0:T+1,u=0===T?p-1:T-1,S=0,P=null;a.copy(e.edges[T]),h.copy(r).sub(s[T]),t&&h.len2()>i&&(t.aInB=!1);var d=n(a,h);if(d===y){a.copy(e.edges[u]);var A=g.pop().copy(r).sub(s[u]);if(d=n(a,A),d===_){var f=h.len();if(f>l)return g.push(r),g.push(a),g.push(h),g.push(A),!1;t&&(t.bInA=!1,P=h.normalize(),S=l-f)}g.push(A)}else if(d===_){if(a.copy(e.edges[c]),h.copy(r).sub(s[c]),d=n(a,h),d===y){var f=h.len();if(f>l)return g.push(r),g.push(a),g.push(h),!1;t&&(t.bInA=!1,P=h.normalize(),S=l-f)}}else{var R=a.perp().normalize(),f=h.dot(R),w=Math.abs(f);if(f>0&&w>l)return g.push(r),g.push(R),g.push(h),!1;t&&(P=R,S=l-f,(f>=0||S<2*l)&&(t.bInA=!1))}P&&t&&Math.abs(S)<Math.abs(t.overlap)&&(t.overlap=S,t.overlapN.copy(P))}return t&&(t.a=e,t.b=o,t.overlapV.copy(t.overlapN).scale(t.overlap)),g.push(r),g.push(a),g.push(h),!0}function c(e,o,t){var r=T(o,e,t);if(r&&t){var l=t.a,i=t.aInB;t.overlapN.reverse(),t.overlapV.reverse(),t.a=t.b,t.b=l,t.aInB=t.bInA,t.bInA=i}return r}function u(e,o,t){for(var r=e.calcPoints,l=r.length,i=o.calcPoints,n=i.length,p=0;p<l;p++)if(s(e.pos,o.pos,r,i,e.normals[p],t))return!1;for(var p=0;p<n;p++)if(s(e.pos,o.pos,r,i,o.normals[p],t))return!1;return t&&(t.a=e,t.b=o,t.overlapV.copy(t.overlapN).scale(t.overlap)),!0}var S={};S.Vector=e,S.V=e,e.prototype.copy=e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.clone=e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.perp=e.prototype.perp=function(){var e=this.x;return this.x=this.y,this.y=-e,this},e.prototype.rotate=e.prototype.rotate=function(e){var o=this.x,t=this.y;return this.x=o*Math.cos(e)-t*Math.sin(e),this.y=o*Math.sin(e)+t*Math.cos(e),this},e.prototype.reverse=e.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.normalize=e.prototype.normalize=function(){var e=this.len();return e>0&&(this.x=this.x/e,this.y=this.y/e),this},e.prototype.add=e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.sub=e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.scale=e.prototype.scale=function(e,o){return this.x*=e,this.y*=o||e,this},e.prototype.project=e.prototype.project=function(e){var o=this.dot(e)/e.len2();return this.x=o*e.x,this.y=o*e.y,this},e.prototype.projectN=e.prototype.projectN=function(e){var o=this.dot(e);return this.x=o*e.x,this.y=o*e.y,this},e.prototype.reflect=e.prototype.reflect=function(e){var o=this.x,t=this.y;return this.project(e).scale(2),this.x-=o,this.y-=t,this},e.prototype.reflectN=e.prototype.reflectN=function(e){var o=this.x,t=this.y;return this.projectN(e).scale(2),this.x-=o,this.y-=t,this},e.prototype.dot=e.prototype.dot=function(e){return this.x*e.x+this.y*e.y},e.prototype.len2=e.prototype.len2=function(){return this.dot(this)},e.prototype.len=e.prototype.len=function(){return Math.sqrt(this.len2())},S.Circle=o,o.prototype.getAABB=o.prototype.getAABB=function(){var o=this.r,t=this.pos.clone().sub(new e(o,o));return new r(t,2*o,2*o).toPolygon()},S.Polygon=t,t.prototype.setPoints=t.prototype.setPoints=function(o){var t=!this.points||this.points.length!==o.length;if(t){var r,l=this.calcPoints=[],i=this.edges=[],s=this.normals=[];for(r=0;r<o.length;r++)l.push(new e),i.push(new e),s.push(new e)}return this.points=o,this._recalc(),this},t.prototype.setAngle=t.prototype.setAngle=function(e){return this.angle=e,this._recalc(),this},t.prototype.setOffset=t.prototype.setOffset=function(e){return this.offset=e,this._recalc(),this},t.prototype.rotate=t.prototype.rotate=function(e){for(var o=this.points,t=o.length,r=0;r<t;r++)o[r].rotate(e);return this._recalc(),this},t.prototype.translate=t.prototype.translate=function(e,o){for(var t=this.points,r=t.length,l=0;l<r;l++)t[l].x+=e,t[l].y+=o;return this._recalc(),this},t.prototype._recalc=function(){var e,o=this.calcPoints,t=this.edges,r=this.normals,l=this.points,i=this.offset,s=this.angle,n=l.length;for(e=0;e<n;e++){var p=o[e].copy(l[e]);p.x+=i.x,p.y+=i.y,0!==s&&p.rotate(s)}for(e=0;e<n;e++){var a=o[e],h=e<n-1?o[e+1]:o[0],T=t[e].copy(h).sub(a);r[e].copy(T).perp().normalize()}return this},t.prototype.getAABB=t.prototype.getAABB=function(){for(var o=this.calcPoints,t=o.length,l=o[0].x,i=o[0].y,s=o[0].x,n=o[0].y,p=1;p<t;p++){var a=o[p];a.x<l?l=a.x:a.x>s&&(s=a.x),a.y<i?i=a.y:a.y>n&&(n=a.y)}return new r(this.pos.clone().add(new e(l,i)),s-l,n-i).toPolygon()},S.Box=r,r.prototype.toPolygon=r.prototype.toPolygon=function(){var o=this.pos,r=this.w,l=this.h;return new t(new e(o.x,o.y),[new e,new e(r,0),new e(r,l),new e(0,l)])},S.Response=l,l.prototype.clear=l.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var g=[],P=0;P<10;P++)g.push(new e);for(var d=[],P=0;P<5;P++)d.push([]);var A=new l,f=new r(new e,1e-6,1e-6).toPolygon();S.isSeparatingAxis=s;var y=-1,R=0,_=1;return S.pointInCircle=p,S.pointInPolygon=a,S.testCircleCircle=h,S.testPolygonCircle=T,S.testCirclePolygon=c,S.testPolygonPolygon=u,S});